<div class="container">
  <div class="row w-auto my-4 d-flex justify-content-start align-items-center">
    <div>
      <h2 class="my-4">Panel Administrador</h2>
    </div>
    <div class="col-2">
      <button class="btn btn-primary" (click)="abrirModal()">Crear</button>
    </div>
  </div>

  <div class="d-flex flex-wrap justify-content-center">
    <!-- Filtro lateral -->
    <!-- Barra categorías -->
    <div class="d-flex justify-content-center p-3  w-100">
      <div class="col-12 justify-content-center text-center">
        <div class="row">
          <h2>Filtro de Categorias</h2>
        </div>
        <div class="row">
          <ul class="nav nav-pills gap-2">
            <li class="nav-item">
              <button (click)="setCategory('')" [class.active]="selectedCategory === ''" class="nav-link">
                Todos
              </button>
            </li>
            @for (category of categories; track category) {
            <li class="nav-item">
              <button (click)="setCategory(category)" [class.active]="selectedCategory === category" class="nav-link">
                {{ category }}
              </button>
            </li>
            }
          </ul>
        </div>
      </div>
    </div>


    <!-- Lista de torneos -->
    <div class="col-sm-10 p-3">
      <h3 class="mb-3 text-center ">Torneos</h3>

      <!-- Filtro de orden -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <p class="mb-0 fw-bold">Mostrando {{ filteredTournaments.length }} resultados</p>
        <form class="d-flex align-items-center">
          <label class="me-2 mb-0 fw-bold">Ordenar por:</label>
          <select [(ngModel)]="sortOrder" (ngModelChange)="page = 1" name="orderby"
            class="form-select form-select-sm w-auto">
            <option value="">Defecto</option>
            <option value="date">Fecha: cercana primero</option>
            <option value="date-desc">Fecha: lejana primero</option>
            <option value="price">Inscripción: bajo a alto</option>
            <option value="price-desc">Inscripción: alto a bajo</option>
          </select>
        </form>
      </div>

      <!-- Tarjetas -->
      <div class="d-flex flex-wrap justify-content-center align-items-stretch gap-3 m-2">
        <div *ngFor="let t of filteredTournaments | paginate: { itemsPerPage: itemsPerPage, currentPage: page }"
          class="card bg-dark text-white border border-secondary shadow-sm torneo-card"
          [ngClass]="{
       'insCerrada': t.fechaCierreInscripcion < today,
       'insAbierto': t.fechaCierreInscripcion >= today,
       'cerrado': t.status === 'Cerrado',
       'abierto': t.status !== 'Cerrado'
     }" style="width: 300px;">
        
          <!-- Imagen cuadrada 1:1 -->
          <div class="ratio" style="--bs-aspect-ratio: 141%;">
            <img [src]="badgeFor(t.nombre)" [alt]="t.nombre" class="card-img-top object-fit-contain rounded-top">
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-1 text-truncate">{{ t.nombre }}</h5>
            <p class="card-subtitle text-muted small mb-2">
              {{ t.sede }} {{ t.fechaInicio | date:'dd/MM/yyyy' }}
            </p>
            <p class="card-subtitle text-muted small mb-2">
              Inscripción hasta: {{ t.fechaCierreInscripcion | date:'dd/MM/yyyy' }}
            </p>

            <div class="mb-2 d-flex flex-wrap gap-2 align-items-center">
              <span class="badge bg-info">{{ t.modalidad }}</span>
              <!-- todas las categorías del torneo -->
              <ng-container *ngFor="let c of t.categorias">
                <span class="badge bg-secondary">{{ c }}</span>
              </ng-container>
            </div>

            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">{{ t.status }}</span>
              <button class="btn btn-outline-light btn-sm" (click)="verTorneo(t)">Ver detalles</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Paginación -->
      <pagination-controls class="d-flex justify-content-center mt-3 fw-bold" (pageChange)="page = $event"
        previousLabel="Anterior" nextLabel="Siguiente">
      </pagination-controls>
    </div>
  </div>

</div>